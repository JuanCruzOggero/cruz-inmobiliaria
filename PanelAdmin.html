<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Admin - Cruz Inmobiliaria</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; }
    .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
    .login-box { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); max-width: 400px; width: 100%; }
    .login-box h1 { text-align: center; margin-bottom: 10px; font-size: 2rem; color: #333; }
    .login-box p { text-align: center; color: #666; margin-bottom: 30px; }
    .login-form { display: flex; flex-direction: column; gap: 20px; }
    .login-form input { padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: 0.3s; }
    .login-form input:focus { border-color: #0d6efd; outline: none; }
    .login-form button { background: linear-gradient(135deg, #0d6efd 0%, #0842a0 100%); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: 0.3s; }
    .login-form button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(13, 110, 253, 0.5); }
    .login-form button:disabled { opacity: 0.6; cursor: not-allowed; }
    .login-error { background: #f8d7da; color: #842029; padding: 12px; border-radius: 8px; text-align: center; border: 1px solid #f5c2c7; display: none; }
    .login-error.show { display: block; animation: shake 0.5s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .admin-panel { display: none; }
    .admin-panel.show { display: block; }
    .header { background: #000; color: white; padding: 20px 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .header h1 { font-size: 1.8rem; font-weight: 700; letter-spacing: 1px; }
    .header-actions { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
    .user-info { color: #aaa; font-size: 0.9rem; }
    .btn-home { background: #0d6efd; color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; transition: 0.3s; }
    .btn-home:hover { background: #0842a0; }
    .btn-logout { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .btn-logout:hover { background: #bb2d3b; }
    .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-left: 5px solid; }
    .stat-card.ventas { border-left-color: #198754; }
    .stat-card.alquileres { border-left-color: #ffc107; }
    .stat-card.total { border-left-color: #0d6efd; }
    .stat-card h3 { font-size: 2.5rem; margin-bottom: 5px; font-weight: 700; }
    .stat-card p { color: #666; font-weight: 600; }
    .btn-primary { background: linear-gradient(135deg, #0d6efd 0%, #0842a0 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; font-weight: 700; cursor: pointer; font-size: 1rem; transition: 0.3s; box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3); margin-bottom: 20px; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(13, 110, 253, 0.5); }
    .form-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px; display: none; }
    .form-container.show { display: block; animation: slideDown 0.3s ease; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    .form-container h2 { margin-bottom: 25px; color: #333; font-size: 1.8rem; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
    .form-group { display: flex; flex-direction: column; }
    .form-group label { font-weight: 600; margin-bottom: 8px; color: #444; }
    .form-group input, .form-group select, .form-group textarea { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: 0.3s; font-family: inherit; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #0d6efd; outline: none; }
    .form-group input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
    .form-group input[type="file"] { padding: 10px; }
    .checkbox-group { display: flex; align-items: center; gap: 10px; }
    .image-preview { margin-top: 10px; max-width: 200px; border-radius: 8px; display: none; }
    .image-preview.show { display: block; }
    .upload-progress { margin-top: 10px; display: none; }
    .upload-progress.show { display: block; }
    .progress-bar { width: 100%; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; background: #0d6efd; transition: width 0.3s; }
    .form-actions { display: flex; gap: 15px; flex-wrap: wrap; }
    .btn-save { background: #198754; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .btn-save:hover { background: #146c43; transform: translateY(-2px); }
    .btn-save:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn-cancel { background: #6c757d; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .btn-cancel:hover { background: #5c636a; }
    .properties-list { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; }
    .list-header { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 20px 30px; }
    .list-header h2 { font-size: 1.5rem; }
    .property-item { padding: 25px 30px; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; gap: 20px; transition: 0.3s; flex-wrap: wrap; }
    .property-item:hover { background: #f8f9fa; }
    .property-item:last-child { border-bottom: none; }
    .property-image { width: 120px; height: 90px; object-fit: cover; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .property-info { flex: 1; min-width: 200px; }
    .property-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; margin-bottom: 8px; text-transform: uppercase; }
    .badge-venta { background: #198754; color: white; }
    .badge-alquiler { background: #ffc107; color: #000; }
    .badge-tasacion { background: #6c757d; color: white; }
    .badge-administracion { background: #0dcaf0; color: #000; }
    .featured-badge { background: #dc3545; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem; margin-left: 8px; }
    .property-info h3 { font-size: 1.2rem; margin-bottom: 5px; color: #333; }
    .property-info p { color: #666; font-size: 0.95rem; margin-bottom: 8px; }
    .property-price { color: #0d6efd; font-weight: 700; font-size: 1.2rem; }
    .property-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn-edit, .btn-delete { border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; }
    .btn-edit { background: #0d6efd; color: white; }
    .btn-edit:hover { background: #0842a0; }
    .btn-delete { background: #dc3545; color: white; }
    .btn-delete:hover { background: #bb2d3b; }
    .alert { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: 600; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .alert-success { background: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
    .alert-error { background: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }
    .empty-state { text-align: center; padding: 60px 20px; color: #999; }
    .empty-state h3 { font-size: 1.5rem; margin-bottom: 10px; }
    .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 9999; display: none; }
    .loading-overlay.show { display: flex; }
    .loading-spinner { background: white; padding: 30px; border-radius: 15px; text-align: center; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #0d6efd; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (max-width: 768px) { .header { flex-direction: column; gap: 15px; padding: 20px; } .property-item { flex-direction: column; align-items: flex-start; } .property-actions { width: 100%; } .btn-edit, .btn-delete { flex: 1; } }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"><div class="spinner"></div><p>Cargando...</p></div></div>
  <div class="login-container" id="loginScreen">
    <div class="login-box">
      <h1>üîê Acceso Administrativo</h1>
      <p>Panel de Control - Cruz Inmobiliaria</p>
      <div class="login-error" id="loginError">Usuario o contrase√±a incorrectos</div>
      <form class="login-form" onsubmit="handleLogin(event)">
        <input type="email" id="loginEmail" placeholder="Email" required autocomplete="username">
        <input type="password" id="loginPassword" placeholder="Contrase√±a" required autocomplete="current-password">
        <button type="submit" id="loginBtn">Iniciar Sesi√≥n</button>
      </form>
    </div>
  </div>
  <div class="admin-panel" id="adminPanel">
    <div class="header">
      <h1>üè† Panel de Administraci√≥n - Cruz Inmobiliaria</h1>
      <div class="header-actions">
        <span class="user-info" id="userInfo"></span>
        <a href="index.html" class="btn-home" target="_blank">Ver Sitio Web</a>
        <button class="btn-logout" onclick="logout()">üö™ Cerrar Sesi√≥n</button>
      </div>
    </div>
    <div class="container">
      <div id="alertContainer"></div>
      <div class="stats">
        <div class="stat-card ventas"><h3 id="ventasCount">0</h3><p>Ventas</p></div>
        <div class="stat-card alquileres"><h3 id="alquileresCount">0</h3><p>Alquileres</p></div>
        <div class="stat-card total"><h3 id="totalCount">0</h3><p>Total Propiedades</p></div>
      </div>
      <button class="btn-primary" onclick="toggleForm()">‚ûï Agregar Nueva Propiedad</button>
      <div class="form-container" id="formContainer">
        <h2 id="formTitle">Nueva Propiedad</h2>
        <div class="form-grid">
          <div class="form-group"><label>Tipo de Operaci√≥n *</label><select id="inputType"><option value="venta">Venta</option><option value="alquiler">Alquiler</option><option value="tasacion">Tasaci√≥n</option><option value="administracion">Administraci√≥n</option></select></div>
          <div class="form-group"><label>Tipo de Propiedad *</label><select id="inputPropertyType"><option value="casa">Casa</option><option value="departamento">Departamento</option><option value="terreno">Terreno</option><option value="cochera">Cochera</option><option value="local">Local</option></select></div>
          <div class="form-group"><label>Ubicaci√≥n *</label><select id="inputLocation"><option value="banda-norte">Banda Norte</option><option value="centro">Centro</option><option value="abilene">Abilene</option><option value="bimaco">Bimaco</option><option value="alberdi">Alberdi</option><option value="las-quintas">Las Quintas</option></select></div>
          <div class="form-group"><label>Precio *</label><input type="text" id="inputPrice" placeholder="USD 120.000 o $200.000/mes"></div>
          <div class="form-group" style="grid-column: 1 / -1;"><label>T√≠tulo *</label><input type="text" id="inputTitle" placeholder="Ej: Casa moderna en el centro"></div>
          <div class="form-group" style="grid-column: 1 / -1;"><label>Descripci√≥n *</label><textarea id="inputDescription" rows="3" placeholder="3 dormitorios, 2 ba√±os, cochera ‚Ä¢ Centro"></textarea></div>
          <div class="form-group" style="grid-column: 1 / -1;"><label>Imagen de la Propiedad</label><input type="file" id="inputImage" accept="image/*" onchange="previewImage(event)"><img id="imagePreview" class="image-preview" alt="Vista previa"><div class="upload-progress" id="uploadProgress"><div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div><p id="progressText">Subiendo imagen...</p></div></div>
          <div class="form-group"><div class="checkbox-group"><input type="checkbox" id="inputFeatured"><label for="inputFeatured" style="margin: 0;">Destacar en carrusel principal</label></div></div>
        </div>
        <div class="form-actions">
          <button class="btn-save" onclick="saveProperty()" id="saveBtn">üíæ Guardar Propiedad</button>
          <button class="btn-cancel" onclick="cancelForm()">‚ùå Cancelar</button>
        </div>
      </div>
      <div class="properties-list">
        <div class="list-header"><h2>Propiedades Actuales (<span id="listCount">0</span>)</h2></div>
        <div id="propertiesList"><div class="empty-state"><h3>Cargando propiedades...</h3></div></div>
      </div>
    </div>
  </div>
  <script type="module">
    import{initializeApp as e}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import{getAuth as t,signInWithEmailAndPassword as o,signOut as i,onAuthStateChanged as a}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{getFirestore as n,collection as r,addDoc as s,getDocs as l,doc as d,updateDoc as c,deleteDoc as p,query as m,orderBy as g,serverTimestamp as u}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import{getStorage as y,ref as h,uploadBytesResumable as f,getDownloadURL as b,deleteObject as v}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";const w=t(e({apiKey:"AIzaSyAUIKeALIRvKUSQ0R8_N_fEGRQ3bc00gp0",authDomain:"cruz-inmobiliaria.firebaseapp.com",projectId:"cruz-inmobiliaria",storageBucket:"cruz-inmobiliaria.firebasestorage.app",messagingSenderId:"659433029884",appId:"1:659433029884:web:26e0fc1d16b3b09bac5779"})),x=n(e()),I=y(e());let S,L=[],k=null,T="",C=null;function E(e,t){const o=document.getElementById("alertContainer"),i=document.createElement("div");i.className=`alert alert-${t}`,i.textContent=e,o.innerHTML="",o.appendChild(i),setTimeout((()=>{i.remove()}),5e3)}function D(){document.getElementById("loginScreen").style.display="flex",document.getElementById("adminPanel").classList.remove("show")}function A(){document.getElementById("loginScreen").style.display="none",document.getElementById("adminPanel").classList.add("show"),document.getElementById("userInfo").textContent=S.email,B()}async function B(){document.getElementById("loadingOverlay").classList.add("show");try{const e=m(r(x,"properties"),g("createdAt","desc")),t=await l(e);L=[],t.forEach((e=>{L.push({id:e.id,...e.data()})})),console.log("‚úÖ Propiedades cargadas:",L.length),O(),_()}catch(e){console.error("‚ùå Error cargando propiedades:",e),E("Error al cargar propiedades","error")}finally{document.getElementById("loadingOverlay").classList.remove("show")}}function O(){const e=L.filter((e=>"venta"===e.type)).length,t=L.filter((e=>"alquiler"===e.type)).length;document.getElementById("ventasCount").textContent=e,document.getElementById("alquileresCount").textContent=t,document.getElementById("totalCount").textContent=L.length,document.getElementById("listCount").textContent=L.length}function _(){const e=document.getElementById("propertiesList");0===L.length?e.innerHTML='<div class="empty-state"><h3>No hay propiedades</h3><p>¬°Agreg√° la primera propiedad usando el bot√≥n de arriba!</p></div>':e.innerHTML=L.map((e=>`\n        <div class="property-item">\n          <img src="${e.image||"https://via.placeholder.com/120x90?text=Sin+Imagen"}" class="property-image" onerror="this.src='https://via.placeholder.com/120x90?text=Sin+Imagen'">\n          <div class="property-info">\n            <span class="property-badge badge-${e.type}">${function(e){return{venta:"Venta",alquiler:"Alquiler",tasacion:"Tasaci√≥n",administracion:"Administraci√≥n"}[e]||e}(e.type)}</span>\n            ${e.featured?'<span class="featured-badge">‚≠ê DESTACADA</span>':""}\n            <h3>${e.title}</h3>\n            <p>${e.description}</p>\n            <p class="property-price">${e.price}</p>\n          </div>\n          <div class="property-actions">\n            <button class="btn-edit" onclick="editProperty('${e.id}')">‚úèÔ∏è Editar</button>\n            <button class="btn-delete" onclick="deleteProperty('${e.id}')">üóëÔ∏è Eliminar</button>\n          </div>\n        </div>\n      `)).join("")}function F(){document.getElementById("inputType").value="venta",document.getElementById("inputPropertyType").value="casa",document.getElementById("inputLocation").value="banda-norte",document.getElementById("inputTitle").value="",document.getElementById("inputDescription").value="",document.getElementById("inputPrice").value="",document.getElementById("inputImage").value="",document.getElementById("inputFeatured").checked=!1,document.getElementById("imagePreview").classList.remove("show"),document.getElementById("formTitle").textContent="Nueva Propiedad"}a(w,(e=>{e?(S=e,A()):(S=null,D())})),window.handleLogin=async function(e){e.preventDefault();const t=document.getElementById("loginEmail").value,a=document.getElementById("loginPassword").value,n=document.getElementById("loginError"),r=document.getElementById("loginBtn");r.disabled=!0,r.textContent="Iniciando...";try{await o(w,t,a)}catch(e){console.error("Error de login:",e),n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),3e3)}finally{r.disabled=!1,r.textContent="Iniciar Sesi√≥n"}},window.logout=async function(){if(confirm("¬øEst√°s seguro de cerrar sesi√≥n?"))try{await i(w)}catch(e){console.error("Error al cerrar sesi√≥n:",e),E("Error al cerrar sesi√≥n","error")}},window.toggleForm=function(){const e=document.getElementById("formContainer");e.classList.toggle("show"),e.classList.contains("show")&&window.scrollTo({top:0,behavior:"smooth"})},window.cancelForm=function(){document.getElementById("formContainer").classList.remove("show"),F(),k=null,C=null,T=""},window.previewImage=function(e){const t=e.target.files[0];if(t){C=t;const e=new FileReader,o=document.getElementById("imagePreview");e.onload=function(e){o.src=e.target.result,o.classList.add("show")},e.readAsDataURL(t)}},window.saveProperty=async function(){const e={type:document.getElementById("inputType").value,propertyType:document.getElementById("inputPropertyType").value,location:document.getElementById("inputLocation").value,title:document.getElementById("inputTitle").value.trim(),description:document.getElementById("inputDescription").value.trim(),price:document.getElementById("inputPrice").value.trim(),featured:document.getElementById("inputFeatured").checked,whatsapp:"https://api.whatsapp.com/send/?phone=543585621318&text&type=phone_number&app_absent=0"};if(!e.title||!e.description||!e.price)return void E("‚ùå Por favor complet√° todos los campos obligatorios (*)","error");const t=document.getElementById("saveBtn");t.disabled=!0,t.textContent="Guardando...",document.getElementById("loadingOverlay").classList.add("show");try{if(C){const o=h(I,`properties/${Date.now()}_${C.name}`),i=f(o,C),a=document.getElementById("uploadProgress"),n=document.getElementById("progressFill");a.classList.add("show"),i.on("state_changed",(e=>{const t=e.bytesTransferred/e.totalBytes*100;n.style.width=t+"%"}),(e=>{console.error("Error subiendo imagen:",e),E("Error al subir la imagen","error")}),(async()=>{e.image=await b(i.snapshot.ref),a.classList.remove("show"),await P(e)}))}else await P(e)}catch(e){console.error("‚ùå Error guardando:",e),E("Error al guardar: "+e.message,"error")}finally{t.disabled=!1,t.textContent="üíæ Guardar Propiedad",document.getElementById("loadingOverlay").classList.remove("show")}};async function P(e){if(k){const t=d(x,"properties",k);await c(t,{...e,updatedAt:u()}),k=null}else e.createdAt=u(),await s(r(x,"properties"),e);E("‚úÖ Propiedad guardada correctamente","success"),window.cancelForm(),await B()}window.editProperty=function(e){const t=L.find((t=>t.id===e));t&&(document.getElementById("inputType").value=t.type,document.getElementById("inputPropertyType").value=t.propertyType,document.getElementById("inputLocation").value=t.location,document.getElementById("inputTitle").value=t.title,document.getElementById("inputDescription").value=t.description,document.getElementById("inputPrice").value=t.price,document.getElementById("inputFeatured").checked=t.featured||!1,t.image&&(document.getElementById("imagePreview").src=t.image,document.getElementById("imagePreview").classList.add("show"),T=t.image),document.getElementById("formTitle").textContent="Editar Propiedad",k=e,document.getElementById("formContainer").classList.add("show"),window.scrollTo({top:0,behavior:"smooth"}))},window.deleteProperty=async function(e){if(confirm("¬øEst√°s seguro de eliminar esta propiedad?")){document.getElementById("loadingOverlay").classList.add("show");try{await p(d(x,"properties",e)),E("‚úÖ Propiedad eliminada correctamente","success"),await B()}catch(e){console.error("‚ùå Error eliminando:",e),E("Error al eliminar: "+e.message,"error")}finally{document.getElementById("loadingOverlay").classList.remove("show")}}};
  </script>
</body>
</html>
